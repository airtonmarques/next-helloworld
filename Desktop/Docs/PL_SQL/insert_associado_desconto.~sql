insert into ts.associado_desconto(cod_ts,
                                  dt_ini_vigencia,
                                  dt_fim_vigencia,
                                  cod_tipo_desconto,
                                  pct_desconto,
                                  cod_usuario_inc,
                                  dt_registro_inc,
                                  cod_usuario_fim,
                                  dt_registro_fim,
                                  txt_observacao,
                                  cod_usuario_atu,
                                  dt_atu)
select distinct b.cod_ts,
                to_date('01/09/2022', 'dd/mm/yyyy'),
                last_day('01/09/2022'),
                --last_day('01/04/2021'),
                2, --Tipo de Desconto: 'UNIMED RN'
                /*
                case pm.ind_participacao 
                  when 'S'
                  then 30
                    else 0 
                end,
                */
                50,
                'ACFARANIO',
                SYSDATE,
                'ACFARANIO',
                SYSDATE,
                'Desconto Comercial 50% 1a parcela',
                'ACFARANIO',
                SYSDATE
from ts.beneficiario b
     --join ts.ppf_proposta p on p.num_seq_proposta_ts = b.num_seq_proposta_ts
     join ts.plano_medico pm on pm.cod_plano = b.cod_plano
where not exists (select 1
                  from ts.associado_desconto ad2
                  where ad2.cod_ts = b.cod_ts
                        and ad2.dt_ini_vigencia = to_date('01/09/2022', 'dd/mm/yyyy'))
and b.num_associado in ()
--and p.num_proposta_adesao in ()      
