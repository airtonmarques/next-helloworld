SELECT ALL_GET_PARCELA_CONTR_BEN_FNC(C.COD_TS_CONTRATO,FAT.DT_INI_PERIODO,NULL,NULL) AS NUM_PARCELA,
       O.NOM_OPERADORA ADM,
       FILIAL.NOME_SUCURSAL FILIAL,
       C.DATA_INICIO_VIGENCIA DT_VIGENCIA,
       C.DT_VENDA DATA_VENDA,
       ES.NOME_RAZAO_SOCIAL NOME_EMPRESA,
       ES.NUM_CGC CNPJ_EMPRESA,
       COBRANCA.DT_VENCIMENTO AS VENCIMENTO,
       COBRANCA.DT_BAIXA AS PAGAMENTO,
       COBRANCA.VAL_A_PAGAR VAL_A_PAGAR,
       COBRANCA.VAL_PAGO VAL_PAGO,

       (select sum(ic.val_item_pagar)
       from ts.itens_cobranca@prod_allsys ic
       where ic.num_seq_cobranca = COBRANCA.NUM_SEQ_COBRANCA
             and ic.NUM_CICLO_TS = COBRANCA.NUM_CICLO_TS) valor_net,

       (SELECT SUM(ITENS.VAL_ITEM_COBRANCA)
        FROM TS.ITENS_COBRANCA@prod_allsys ITENS
        WHERE ITENS.NUM_SEQ_COBRANCA = COBRANCA.NUM_SEQ_COBRANCA
              AND ITENS.COD_TIPO_RUBRICA IN (38, 55, 145, 245, 246)
              AND ITENS.NUM_CICLO_TS = COBRANCA.NUM_CICLO_TS) VAL_DESCONTO,
       OP.NOM_OPERADORA NOM_OPERADORA,
       REGRAEMPRESA.NOME_TIPO_EMPRESA PORTE,
       TIPOVENDA.NOM_TIPO_VENDA NOM_TIPO_VENDA,
       COUNT(*) AS VIDAS,
       TRUNC(COBRANCA.DT_BAIXA - COBRANCA.DT_BAIXA) DIAS_PAGAMENTO_MENOS_VENDA,
       LPAD(VENDEDOR.COD_CORRETOR, 11, '0') CPF_CORRETOR,
       ESVENDEDOR.NOME_ENTIDADE NOME_CORRETOR,
       CORRETORA.COD_CORRETOR COD_CORRETORA,
       ESCORRETORA.NOME_ENTIDADE NOME_CORRETORA,
       PP.NUM_PROPOSTA NUM_PROPOSTA,
       PP.NUM_PROPOSTA_PJ NUM_PROPOSTA_PJ,
       PLANO.COD_PLANO,
       PLANO.NOME_PLANO
  FROM TS.CONTRATO_EMPRESA@prod_allsys C
  JOIN TS.ENTIDADE_SISTEMA@prod_allsys ES ON ES.COD_ENTIDADE_TS = C.COD_TITULAR_CONTRATO
  JOIN TS.OPERADORA@prod_allsys O on O.COD_OPERADORA = C.COD_OPERADORA
  JOIN TS.COBRANCA@prod_allsys COBRANCA ON COBRANCA.COD_TS_CONTRATO = C.COD_TS_CONTRATO
  JOIN TS.FATURA@prod_allsys FAT ON FAT.NUM_SEQ_FATURA_TS = COBRANCA.NUM_SEQ_FATURA_TS
  JOIN TS.SUCURSAL@prod_allsys FILIAL ON FILIAL.COD_SUCURSAL = C.COD_SUCURSAL
  JOIN TS.REGRA_EMPRESA@prod_allsys REGRAEMPRESA ON REGRAEMPRESA.TIPO_EMPRESA = C.TIPO_EMPRESA
  JOIN TS.TIPO_VENDA@prod_allsys TIPOVENDA ON TIPOVENDA.COD_TIPO_VENDA = C.COD_TIPO_VENDA
  JOIN TS.PPF_OPERADORAS@prod_allsys OP ON OP.COD_OPERADORA = C.COD_OPERADORA_CONTRATO
  LEFT JOIN TS.ASSOCIADO@prod_allsys ASSOCIADO ON ASSOCIADO.COD_TS_CONTRATO = C.COD_TS_CONTRATO
  LEFT JOIN TS.PJ_PROPOSTA@prod_allsys PP ON PP.NUM_SEQ_PROPOSTA_PJ_TS = C.NUM_SEQ_PROPOSTA_PJ_TS
  LEFT JOIN TS.CORRETOR_VENDA@prod_allsys VENDEDOR ON VENDEDOR.COD_CORRETOR_TS = PP.COD_VENDEDOR_TS
  LEFT JOIN TS.ENTIDADE_SISTEMA@prod_allsys ESVENDEDOR ON ESVENDEDOR.COD_ENTIDADE_TS = VENDEDOR.COD_ENTIDADE_TS
  LEFT JOIN TS.CORRETOR_VENDA@prod_allsys CORRETORA ON CORRETORA.COD_CORRETOR_TS = PP.COD_PRODUTOR_TS
  LEFT JOIN TS.ENTIDADE_SISTEMA@prod_allsys ESCORRETORA ON ESCORRETORA.COD_ENTIDADE_TS = CORRETORA.COD_ENTIDADE_TS
  LEFT JOIN (SELECT MAX(PLANO.COD_PLANO) COD_PLANO,
                    MAX(PM.NOME_PLANO) NOME_PLANO,
                    PLANO.NUM_SEQ_PROPOSTA_PJ_TS
               FROM TS.PJ_PLANOS@prod_allsys PLANO,
                    TS.PLANO_MEDICO@prod_allsys PM
              WHERE PLANO.COD_PLANO = PM.COD_PLANO
           GROUP BY PLANO.NUM_SEQ_PROPOSTA_PJ_TS) PLANO
         ON PP.NUM_SEQ_PROPOSTA_PJ_TS = PLANO.NUM_SEQ_PROPOSTA_PJ_TS
      WHERE COBRANCA.VAL_PAGO IS NOT NULL
        AND COBRANCA.DT_CANCELAMENTO IS NULL
        AND COBRANCA.VAL_PAGO > 0
        --AND COBRANCA.IND_ESTADO_COBRANCA = 1
        AND C.IND_SITUACAO = 'A'
        AND REGRAEMPRESA.TIPO_EMPRESA NOT IN(1)
        AND COBRANCA.DT_BAIXA between TO_DATE('01/11/2021', 'dd/mm/yyyy') and last_day('01/11/2021')
and C.num_contrato IN ('24956',
'24973',
'24975',
'24981',
'24982',
'24983',
'24984',
'24985',
'24986',
'24987',
'24988',
'24989',
'24990',
'24991',
'24992',
'24993',
'24994',
'24995',
'24996',
'24997',
'24998',
'24999',
'25000',
'25001',
'25002',
'25003',
'25004',
'25005',
'25006',
'25007',
'25008',
'25009',
'25010',
'25011',
'25012',
'25013',
'25014',
'25015',
'25016',
'25017',
'25018',
'25019',
'25020',
'25021',
'25022',
'25023',
'25024',
'25025',
'25026',
'25027',
'25028',
'25029',
'25030',
'25031',
'25032',
'25033',
'25034',
'25035',
'25036',
'25037',
'25038',
'25039',
'25040',
'25041',
'25042',
'25043',
'25044',
'25045',
'25046',
'25047',
'25049',
'25050',
'25051',
'25052',
'25053',
'25054',
'25055',
'25056',
'25057',
'25058',
'25059',
'25060',
'25061',
'25062',
'25063',
'25064',
'25065',
'25066',
'25067',
'25068',
'25069',
'25070',
'25071',
'25072',
'25073',
'25074',
'25075',
'25076',
'25077',
'25078',
'25079',
'25080',
'25081',
'25082',
'25083',
'25084',
'25085',
'25086',
'25087',
'25088',
'25089',
'25090',
'25091',
'25092',
'25093',
'25094',
'25095',
'25096',
'25097',
'25098',
'25099',
'25100',
'25101',
'25102',
'25103',
'25104',
'25105',
'25106',
'25107',
'25108',
'25109',
'25110',
'25111',
'25112',
'25113',
'25114',
'25115',
'25116',
'25117',
'25118',
'25119',
'25120',
'25121',
'25122',
'25123',
'25124',
'25125',
'25126',
'25127',
'25128',
'25129',
'25130',
'25131',
'25132',
'25133',
'25134',
'25135',
'25136',
'25137',
'25138',
'25139',
'25140',
'25141',
'25142',
'25143',
'25144',
'25145',
'25146',
'25147',
'25148',
'25149',
'25150',
'25151',
'25152',
'25153',
'25154',
'25155',
'25156',
'25157',
'25158',
'25159',
'25160',
'25161',
'25162',
'25163',
'25164',
'25165',
'25166',
'25167',
'25168',
'25169',
'25170',
'25171',
'25172',
'25173',
'25174',
'25175',
'25176',
'25177',
'25178',
'25179',
'25180',
'25181',
'25182',
'25183',
'25184',
'25185',
'25186',
'25187',
'25188',
'25189',
'25190',
'25191',
'25192',
'25193',
'25194',
'25195',
'25196',
'25197',
'25198',
'25199',
'25200',
'25201',
'25202',
'25203',
'25204',
'25205',
'25206',
'25207',
'25208',
'25209',
'25210',
'25211',
'25212',
'25213',
'25214',
'25215',
'25216',
'25217',
'25218',
'25219',
'25220',
'25221',
'25222',
'25223',
'25224',
'25225',
'25226',
'25227',
'25228',
'25229',
'25230',
'25231',
'25232',
'25233',
'25234',
'25235',
'25236',
'25237',
'25238',
'25239',
'25240',
'25241',
'25242',
'25243',
'25244',
'25245',
'25246',
'25247',
'25248',
'25249',
'25250',
'25251',
'25252',
'25253',
'25254',
'25255',
'25256',
'25257',
'25258',
'25259',
'25260',
'25261',
'25262',
'25263',
'25264',
'25265',
'25266',
'25267',
'25268',
'25269',
'25271',
'25272',
'25274',
'25275',
'25276',
'25277',
'25278',
'25279',
'25280',
'25281',
'25282',
'25283',
'25284',
'25285',
'25286',
'25287',
'25288',
'25289',
'25290',
'25291',
'25292',
'25293',
'25294',
'25295',
'25296',
'25297',
'25298',
'25299',
'25300',
'25301',
'25302',
'25303',
'25304',
'25305',
'25306',
'25307',
'25308',
'25309',
'25310',
'25311',
'25312',
'25313',
'25314',
'25315',
'25316',
'25317',
'25318',
'25319',
'25320',
'25321',
'25322',
'25323',
'25324',
'25325',
'25326',
'25327',
'25328',
'25329',
'25330',
'25331',
'25332',
'25333',
'25334',
'25335',
'25336',
'25337',
'25338',
'25339',
'25340',
'25341',
'25342',
'25343',
'25344',
'25345',
'25346',
'25347',
'25348',
'25349',
'25350',
'25351',
'25352',
'25353',
'25354',
'25355',
'25356',
'25357',
'25358',
'25359',
'25360',
'25361',
'25362',
'25363',
'25364',
'25365',
'25366',
'25367',
'25368',
'25369',
'25370',
'25371',
'25372',
'25373',
'25374',
'25375',
'25376',
'25377',
'25378',
'25379',
'25380',
'25381',
'25382',
'25383',
'25384',
'25385',
'25386',
'25388',
'25389',
'25390',
'25391',
'25392',
'25393',
'25394',
'25395',
'25396',
'25397',
'25398',
'25399',
'25400',
'25401',
'25402',
'25403',
'25404',
'25405',
'25406',
'25407',
'25408',
'25409',
'25410',
'25411',
'25412',
'25413',
'25414',
'25415',
'25416',
'25417',
'25418',
'25419',
'25420',
'25421',
'25422',
'25423',
'25424',
'25425',
'25426',
'25427',
'25428',
'25429',
'25430',
'25431',
'25432',
'25433',
'25434',
'25435',
'25436',
'25437',
'25438',
'25439',
'25440',
'25441',
'25442',
'25443',
'25445',
'25446',
'25447',
'25448',
'25449',
'25450',
'25451',
'25452',
'25453',
'25454',
'25455',
'25456',
'25457',
'25458',
'25459',
'25460',
'25461',
'25462',
'25463',
'25464',
'25465',
'25466',
'25467',
'25468',
'25469',
'25470',
'25471',
'25472',
'25473',
'25474',
'25475',
'25476',
'25477',
'25478',
'25479',
'25480',
'25481',
'25482',
'25483',
'25484',
'25485',
'25486',
'25487',
'25488',
'25489',
'25490',
'25491',
'25492',
'25493',
'25494',
'25495',
'25496',
'25497',
'25498',
'25499',
'25500',
'25501',
'25502',
'25503',
'25504',
'25505',
'25506',
'25507',
'25508',
'25509',
'25510',
'25511',
'25512',
'25513',
'25514',
'25515',
'25516',
'25517',
'25518',
'25519',
'25520',
'25521',
'25522',
'25523',
'25525',
'25526',
'25527',
'25528',
'25529',
'25530',
'25531',
'25532',
'25533',
'25534',
'25535',
'25536',
'25537',
'25538',
'25539',
'25540',
'25541',
'25542',
'25543',
'25544',
'25545',
'25546',
'25547',
'25548',
'25549',
'25550',
'25551',
'25552',
'25553',
'25554',
'25555',
'25556',
'25557',
'25559',
'25560',
'25561',
'25562',
'25563',
'25564',
'25565',
'25566',
'25567',
'25568',
'25569',
'25570',
'25571',
'25572',
'25573',
'25574',
'25575',
'25576',
'25577',
'25578',
'25579',
'25580',
'25581',
'25582',
'25583',
'25584',
'25585',
'25586',
'25587',
'25588',
'25589',
'25590',
'25591',
'25592',
'25593',
'25594',
'25595',
'25596',
'25597',
'25598',
'25599',
'25600',
'25601',
'25602',
'25603',
'25604',
'25605',
'25606',
'25607',
'25608',
'25609',
'25610',
'25611',
'25612',
'25613',
'25614',
'25615',
'25616',
'25617',
'25618',
'25619',
'25620',
'25621',
'25622',
'25623',
'25624',
'25625',
'25626',
'25627',
'25628',
'25629',
'25630',
'25631',
'25632',
'25633',
'25634',
'25635',
'25636',
'25637',
'25638',
'25639',
'25640',
'25641',
'25642',
'25643',
'25644',
'25645',
'25646',
'25647',
'25648',
'25649',
'25650',
'25651',
'25652',
'25653',
'25654',
'25655',
'25656',
'25657',
'25658',
'25659',
'25660',
'25661',
'25662',
'25663',
'25664',
'25665',
'25666',
'25667',
'25668',
'25669',
'25670',
'25671',
'25672',
'25673',
'25674',
'25675',
'25676',
'25677',
'25678',
'25679',
'25680',
'25681',
'25682',
'25683',
'25684',
'25685',
'25686',
'25687',
'25688',
'25689',
'25690',
'25691',
'25692',
'25693',
'25694',
'25695',
'25696',
'25697',
'25698',
'25699',
'25700',
'25701',
'25703',
'25767',
'25775',
'25776',
'25777',
'25778',
'25901',
'25902',
'25910',
'25912',
'25921',
'25922',
'25924',
'26097',
'26258',
'26259',
'26260',
'26550',
'26843',
'26844',
'25931',
'25932',
'26076',
'26144',
'26576',
'26600',
'27109',
'27114',
'27115',
'27119',
'27121',
'27122',
'27123',
'27124',
'27173',
'27411',
'27412',
'27413',
'27414',
'27415',
'27418',
'27419',
'27420',
'26080',
'26649',
'26650',
'26658',
'26659')
GROUP BY ALL_GET_PARCELA_CONTR_BEN_FNC(C.COD_TS_CONTRATO,FAT.DT_INI_PERIODO,NULL,NULL),
          O.NOM_OPERADORA,
         FILIAL.NOME_SUCURSAL,
         C.DATA_INICIO_VIGENCIA,
         ES.NOME_RAZAO_SOCIAL,
         ES.NUM_CGC,
         COBRANCA.DT_VENCIMENTO,
         COBRANCA.DT_BAIXA,
         COBRANCA.VAL_A_PAGAR,
         COBRANCA.VAL_PAGO,
         COBRANCA.VAL_DESCONTO,
         OP.NOM_OPERADORA,
         REGRAEMPRESA.NOME_TIPO_EMPRESA,
         TIPOVENDA.NOM_TIPO_VENDA,
         COBRANCA.COD_TS,
         COBRANCA.COD_TS_CONTRATO,
         COBRANCA.DT_COMPETENCIA,
         C.DT_VENDA,
         LPAD(VENDEDOR.COD_CORRETOR, 11, '0') ,
         ESVENDEDOR.NOME_ENTIDADE,
         CORRETORA.COD_CORRETOR,
         ESCORRETORA.NOME_ENTIDADE,
         PP.NUM_PROPOSTA,
         PP.NUM_PROPOSTA_PJ,
         PLANO.COD_PLANO,
         PLANO.NOME_PLANO,
         COBRANCA.NUM_SEQ_COBRANCA,
         COBRANCA.NUM_CICLO_TS
